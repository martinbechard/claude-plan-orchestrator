meta:
  name: Periodic Progress Reporter
  description: Add a periodic progress reporter that sends Slack notifications with
    pipeline throughput, ETA, and upcoming work on a configurable interval (default
    15 minutes). Silent when pipeline is idle.
  source_item: docs/feature-backlog/18-periodic-progress-reporter.md
  plan_doc: docs/plans/2026-02-19-18-periodic-progress-reporter-design.md
  created: '2026-02-19'
  max_attempts_default: 3
  validation:
    enabled: true
    run_after:
    - coder
    validators:
    - validator
    max_validation_attempts: 2
sections:
- id: phase-1
  name: Phase 1 - Constants and CompletionTracker
  status: completed
  tasks:
  - id: '1.1'
    name: Add progress reporter constants and CompletionTracker class
    agent: coder
    status: completed
    description: "Implement the work item: docs/feature-backlog/18-periodic-progress-reporter.md\n\
      Design reference: docs/plans/2026-02-19-18-periodic-progress-reporter-design.md\n\
      This task adds the configuration constants and the CompletionTracker class to\
      \ scripts/auto-pipeline.py.\nSteps: 1. Add constants near the other timing constants\
      \ (around line 142):\n   PROGRESS_REPORT_INTERVAL_SECONDS = int(os.environ.get(\"\
      PIPELINE_REPORT_INTERVAL\", \"900\"))\n   COMPLETION_HISTORY_WINDOW_SECONDS\
      \ = 7200\n   PROGRESS_REPORT_MAX_PREVIEW_ITEMS = 5\n\n2. Add CompletionTracker\
      \ class near SessionUsageTracker (around line 995):\n   - Uses collections.deque\
      \ to store (timestamp, item_type, slug, duration_seconds) tuples\n   - record_completion(item_type,\
      \ slug, duration_seconds) method\n   - prune_old_entries() removes entries older\
      \ than COMPLETION_HISTORY_WINDOW_SECONDS\n   - completions_since(since_timestamp)\
      \ returns list of entries after given time\n   - average_duration_seconds()\
      \ returns mean of all durations in window (or 0.0)\n   - Thread-safe via threading.Lock\n\
      \n3. Verify syntax: python3 -c \"import py_compile; py_compile.compile('scripts/auto-pipeline.py',\
      \ doraise=True)\"\nFiles: scripts/auto-pipeline.py\n"
    attempts: 3
    last_attempt: '2026-02-19T16:05:01.610766'
    model_used: sonnet
    validation_findings: 'Validator ''validator'' failed to execute: No status file
      written by Claude'
    validation_attempts: 2
    completed_at: '2026-02-19T16:05:47.557359'
    result_message: Added PROGRESS_REPORT_INTERVAL_SECONDS, COMPLETION_HISTORY_WINDOW_SECONDS,
      PROGRESS_REPORT_MAX_PREVIEW_ITEMS constants and CompletionTracker class to scripts/auto-pipeline.py.
      Syntax verified. Code committed in 51aa0a0.
- id: phase-2
  name: Phase 2 - ProgressReporter Class
  status: completed
  tasks:
  - id: '2.1'
    name: Add ProgressReporter daemon thread class
    agent: coder
    status: completed
    depends_on:
    - '1.1'
    description: "Implement the work item: docs/feature-backlog/18-periodic-progress-reporter.md\n\
      Design reference: docs/plans/2026-02-19-18-periodic-progress-reporter-design.md\n\
      This task adds the ProgressReporter class to scripts/auto-pipeline.py. Follow\
      \ the CodeChangeMonitor pattern (line 595) for the daemon thread structure.\n\
      Steps: 1. Add ProgressReporter class after CompletionTracker:\n   - __init__(self,\
      \ slack: SlackNotifier, completion_tracker: CompletionTracker,\n     item_in_progress:\
      \ threading.Event, interval: float = PROGRESS_REPORT_INTERVAL_SECONDS)\n   -\
      \ start() / stop() methods matching CodeChangeMonitor pattern\n   - _reporter_loop()\
      \ wakes every interval via _stop_event.wait(timeout=interval)\n   - _should_report()\
      \ checks silence conditions: returns False if\n     not item_in_progress.is_set()\
      \ AND scan_all_backlogs() is empty\n   - _build_report() generates the report\
      \ message string with:\n     a) Queue snapshot by type (defect/feature/analysis\
      \ count)\n     b) Completions since last report (count + breakdown)\n     c)\
      \ Velocity (average completion time from tracker)\n     d) ETA (queue_size x\
      \ average_time)\n     e) Next 5 queued items (name, type)\n   - _send_report()\
      \ calls slack.send_status() with the formatted report\n   - Tracks _last_report_time\
      \ to compute \"completions since last report\"\n\n2. Verify syntax: python3\
      \ -c \"import py_compile; py_compile.compile('scripts/auto-pipeline.py', doraise=True)\"\
      \nFiles: scripts/auto-pipeline.py\n"
    attempts: 3
    last_attempt: '2026-02-19T16:13:14.175771'
    model_used: sonnet
    validation_findings: 'Validator ''validator'' failed to execute: No status file
      written by Claude'
    validation_attempts: 2
    completed_at: '2026-02-19T16:14:01.196531'
    result_message: ProgressReporter daemon thread class added to scripts/auto-pipeline.py
      after CompletionTracker. Implements start/stop methods, _reporter_loop with
      stop_event.wait(timeout), _should_report silence logic, _build_report with queue
      snapshot/completions/velocity/ETA/preview, _send_report, and _format_duration
      helper. Code committed in fa4d572. Syntax verified.
- id: phase-3
  name: Phase 3 - Pipeline Integration
  status: completed
  tasks:
  - id: '3.1'
    name: Integrate reporter and tracker into main_loop and process functions
    agent: coder
    status: completed
    depends_on:
    - '2.1'
    description: "Implement the work item: docs/feature-backlog/18-periodic-progress-reporter.md\n\
      Design reference: docs/plans/2026-02-19-18-periodic-progress-reporter-design.md\n\
      This task wires the CompletionTracker and ProgressReporter into the pipeline.\n\
      Steps: 1. In main_loop() (line 2617):\n   - Create item_in_progress = threading.Event()\
      \ near other local state\n   - Create completion_tracker = CompletionTracker()\n\
      \   - Create reporter = ProgressReporter(slack, completion_tracker, item_in_progress)\n\
      \   - Call reporter.start() after slack.start_background_polling()\n   - Call\
      \ reporter.stop() in the finally block before slack.stop_background_polling()\n\
      \   - Pass item_in_progress and completion_tracker to process_item() calls\n\
      \n2. In process_item() (line 2472):\n   - Add optional params: item_in_progress\
      \ and completion_tracker\n   - Set item_in_progress at entry, clear in finally\
      \ block\n   - After successful archive, call completion_tracker.record_completion()\n\
      \     with elapsed duration\n\n3. In process_analysis_item() (line 2155):\n\
      \   - Add optional params: item_in_progress and completion_tracker\n   - Set\
      \ item_in_progress at entry, clear in finally block\n   - After successful archive,\
      \ call completion_tracker.record_completion()\n     with elapsed duration\n\n\
      4. Update the process_item/process_analysis_item call sites in main_loop()\n\
      \   to pass the new parameters.\n\n5. Verify syntax: python3 -c \"import py_compile;\
      \ py_compile.compile('scripts/auto-pipeline.py', doraise=True)\"\nFiles: scripts/auto-pipeline.py\n"
    attempts: 3
    last_attempt: '2026-02-19T16:24:13.750720'
    model_used: sonnet
    validation_findings: 'Validator ''validator'' failed to execute: No status file
      written by Claude'
    validation_attempts: 2
    completed_at: '2026-02-19T16:25:04.756725'
    result_message: CompletionTracker and ProgressReporter wired into main_loop(),
      process_item(), and process_analysis_item(). All integration was already in
      place from prior attempts. Syntax verified clean.
- id: phase-4
  name: Phase 4 - Unit Tests
  status: pending
  tasks:
  - id: '4.1'
    name: Add unit tests for CompletionTracker and ProgressReporter
    agent: coder
    status: in_progress
    depends_on:
    - '3.1'
    description: "Implement the work item: docs/feature-backlog/18-periodic-progress-reporter.md\n\
      Design reference: docs/plans/2026-02-19-18-periodic-progress-reporter-design.md\n\
      Add unit tests to tests/test_auto_pipeline.py for the new classes.\nTest cases\
      \ for CompletionTracker: - test_completion_tracker_record_and_retrieve: record\
      \ items, verify completions_since() - test_completion_tracker_prune_old: record\
      \ old entries, verify they are pruned - test_completion_tracker_average_duration:\
      \ verify average calculation - test_completion_tracker_empty: verify zero/empty\
      \ returns on fresh tracker - test_completion_tracker_constants: verify PROGRESS_REPORT_INTERVAL_SECONDS\
      \ and\n  COMPLETION_HISTORY_WINDOW_SECONDS exist and have correct defaults\n\
      \nTest cases for ProgressReporter: - test_progress_reporter_silent_when_idle:\
      \ mock scan_all_backlogs() to return [],\n  item_in_progress not set -> _should_report()\
      \ returns False\n- test_progress_reporter_reports_when_active: item_in_progress\
      \ is set ->\n  _should_report() returns True\n- test_progress_reporter_reports_when_queued:\
      \ scan_all_backlogs() returns items,\n  item_in_progress not set -> _should_report()\
      \ returns True\n- test_progress_reporter_build_report_format: verify _build_report()\
      \ returns\n  a string with expected sections (queue, velocity, ETA, preview)\n\
      \nRun tests: python3 -m pytest tests/ -v Fix any failures.\nFiles: tests/test_auto_pipeline.py\n"
    attempts: 1
    last_attempt: '2026-02-19T16:25:07.020494'
