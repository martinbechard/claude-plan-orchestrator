meta:
  name: Ideas Intake Pipeline
  description: Add support for a docs/ideas/ folder where users can drop unformatted
    rough notes. The auto-pipeline detects new files, spawns a Claude session to
    analyze and classify them, and generates properly formatted backlog items in
    the correct folder.
  plan_doc: docs/plans/2026-02-18-ideas-intake-pipeline-design.md
  created: '2026-02-18'
  max_attempts_default: 3
  validation:
    enabled: true
    run_after:
    - coder
    validators:
    - validator
    max_validation_attempts: 1
sections:
- id: phase-1
  name: Phase 1 - Implementation
  status: pending
  tasks:
  - id: '1.1'
    name: Add ideas intake constants and scan function
    agent: coder
    status: pending
    description: "Add the ideas intake constants, directory setup, and scanning\n\
      function to scripts/auto-pipeline.py.\n\nReference: docs/plans/2026-02-18-ideas-intake-pipeline-design.md\n\
      \nSteps:\n1. Read scripts/auto-pipeline.py. Find the constants section near\n\
      \   the top (around lines 59-82, where DEFECT_DIR, FEATURE_DIR, PLANS_DIR,\n\
      \   LOGS_DIR, and REQUIRED_DIRS are defined).\n\n2. After the DESIGN_DIR constant\
      \ (line ~68), add:\n\n   IDEAS_DIR = \"docs/ideas\"\n   IDEAS_PROCESSED_DIR\
      \ = \"docs/ideas/processed\"\n\n3. Add IDEAS_DIR and IDEAS_PROCESSED_DIR to\
      \ the REQUIRED_DIRS list.\n\n4. Add a scan_ideas() function after the scan_all_backlogs()\n\
      \   function (around line 703). It should:\n   - Check if IDEAS_DIR exists;\
      \ return empty list if not\n   - Glob for *.md files in IDEAS_DIR (not recursive,\
      \ skip dotfiles)\n   - Skip empty files (os.path.getsize() == 0)\n   - Skip\
      \ files whose basename already exists in IDEAS_PROCESSED_DIR\n   - Return a\
      \ list of file paths (strings) for unprocessed ideas\n\n5. Verify syntax:\n\
      \   python3 -c \"import py_compile; py_compile.compile('scripts/auto-pipeline.py',\
      \ doraise=True); print('syntax OK')\"\n\nFiles: scripts/auto-pipeline.py\n"
  - id: '1.2'
    name: Add idea intake prompt template and process_idea function
    agent: coder
    status: pending
    depends_on:
    - '1.1'
    description: "Add the Claude prompt template for idea classification and the\n\
      process_idea() function to scripts/auto-pipeline.py.\n\nReference: docs/plans/2026-02-18-ideas-intake-pipeline-design.md\n\
      \nSteps:\n1. Read scripts/auto-pipeline.py. Find the PLAN_CREATION_PROMPT_TEMPLATE\n\
      \   (around line 999) and the VERIFICATION_PROMPT_TEMPLATE (around line 1555).\n\
      \n2. Before PLAN_CREATION_PROMPT_TEMPLATE, add an IDEA_INTAKE_PROMPT_TEMPLATE\n\
      \   string. The prompt should instruct Claude to:\n   - Read the raw idea file\
      \ at {idea_path}\n   - Determine if it describes a feature, defect, or multiple\
      \ items\n   - Assess priority (High, Medium, Low) based on content signals\n\
      \   - For each item, generate a properly formatted backlog .md file with:\n\
      \     ## Status: Open  (or ## Status: Needs Clarification if too vague)\n   \
      \  ## Priority: <assessed priority>\n     ## Summary: <clear one-paragraph summary>\n\
      \     ## Scope: <what areas of the codebase are affected>\n     ## Files Affected:\
      \ <list of files likely needing changes>\n   - Write each item to the correct\
      \ directory:\n     features -> {feature_dir}/<slug>.md\n     defects -> {defect_dir}/<slug>.md\n\
      \   - Use a descriptive filename slug derived from the idea content\n   - Move\
      \ the original idea file to {processed_dir}/\n   - Git commit with message:\
      \ \"intake: classify idea {idea_filename}\"\n   - The template should accept\
      \ these format variables:\n     idea_path, idea_filename, feature_dir, defect_dir,\
      \ processed_dir\n\n3. After scan_ideas(), add a process_idea() function that:\n\
      \   - Takes idea_path (str) and dry_run (bool) parameters\n   - Returns True\
      \ on success, False on failure\n   - In dry-run mode, logs what would happen\
      \ and returns True\n   - Formats the IDEA_INTAKE_PROMPT_TEMPLATE with the idea\
      \ file path\n     and directory constants\n   - Calls run_child_process() with\
      \ CLAUDE_CMD + [\"--dangerously-skip-permissions\",\n     \"--print\", prompt]\n\
      \   - Uses a timeout of PLAN_CREATION_TIMEOUT_SECONDS\n   - Handles rate limiting\
      \ (return False)\n   - On success, verifies the idea file was moved to processed/\n\
      \   - Returns True/False based on success\n\n4. Verify syntax:\n   python3 -c\
      \ \"import py_compile; py_compile.compile('scripts/auto-pipeline.py', doraise=True);\
      \ print('syntax OK')\"\n\nFiles: scripts/auto-pipeline.py\n"
  - id: '1.3'
    name: Add intake_ideas orchestration and wire into main_loop
    agent: coder
    status: pending
    depends_on:
    - '1.2'
    description: "Add the intake_ideas() orchestration function and integrate it\n\
      into the main processing loop in scripts/auto-pipeline.py.\n\nReference: docs/plans/2026-02-18-ideas-intake-pipeline-design.md\n\
      \nSteps:\n1. Read scripts/auto-pipeline.py. Find the process_idea() function\n\
      \   added in the previous task.\n\n2. After process_idea(), add an intake_ideas()\
      \ function that:\n   - Takes dry_run (bool) parameter\n   - Calls scan_ideas()\
      \ to get the list of unprocessed idea files\n   - If no ideas found, returns\
      \ 0\n   - Logs \"Found {n} idea(s) to process\" \n   - Processes each idea sequentially\
      \ via process_idea()\n   - Logs success/failure for each\n   - Returns the count\
      \ of successfully processed ideas\n\n3. Wire intake_ideas() into main_loop():\n\
      \   - Find the main_loop() function (around line 1986)\n   - Inside the while\
      \ True loop, BEFORE the scan_all_backlogs() call\n     (after the in-progress\
      \ plan resumption block), add:\n\n     # Process any raw ideas before scanning\
      \ backlogs\n     intake_count = intake_ideas(dry_run)\n     if intake_count >\
      \ 0:\n         log(f\"Intake: processed {intake_count} idea(s) into backlog\
      \ items\")\n\n4. Extend the BacklogWatcher setup to also watch IDEAS_DIR:\n\
      \   - Find where observer.schedule() is called for DEFECT_DIR and FEATURE_DIR\n\
      \     (around line 2022)\n   - Add IDEAS_DIR to the list of watched directories:\n\
      \     for watch_dir in [DEFECT_DIR, FEATURE_DIR, IDEAS_DIR]:\n\n5. Verify syntax:\n\
      \   python3 -c \"import py_compile; py_compile.compile('scripts/auto-pipeline.py',\
      \ doraise=True); print('syntax OK')\"\n\nFiles: scripts/auto-pipeline.py\n"
- id: phase-2
  name: Phase 2 - Unit Tests
  status: pending
  tasks:
  - id: '2.1'
    name: Add unit tests for scan_ideas()
    agent: coder
    status: pending
    depends_on:
    - '1.1'
    description: "Add unit tests for the scan_ideas() function in auto-pipeline.py.\n\
      \nReference: docs/plans/2026-02-18-ideas-intake-pipeline-design.md\n\nSteps:\n\
      1. Read tests/test_auto_pipeline.py to understand existing test patterns.\n\
      \   Note how the module is imported (likely via importlib).\n\n2. Add the following\
      \ tests:\n\n   a. test_scan_ideas_returns_md_files():\n      - Use tmp_path\
      \ fixture to create a temporary ideas directory\n        with a few .md files.\n\
      \      - Monkeypatch the IDEAS_DIR constant in the auto-pipeline module\n  \
      \      to point to the tmp_path ideas directory.\n      - Call scan_ideas().\n\
      \      - Assert the returned list contains the expected file paths.\n\n   b.\
      \ test_scan_ideas_skips_empty_files():\n      - Create an empty .md file and\
      \ a non-empty .md file.\n      - Monkeypatch IDEAS_DIR.\n      - Call scan_ideas().\n\
      \      - Assert only the non-empty file is returned.\n\n   c. test_scan_ideas_skips_already_processed():\n\
      \      - Create a .md file in ideas dir and a same-named file in the\n     \
      \   processed subdir.\n      - Monkeypatch IDEAS_DIR and IDEAS_PROCESSED_DIR.\n\
      \      - Call scan_ideas().\n      - Assert the already-processed file is not\
      \ returned.\n\n   d. test_scan_ideas_returns_empty_when_dir_missing():\n   \
      \   - Monkeypatch IDEAS_DIR to a non-existent path.\n      - Call scan_ideas().\n\
      \      - Assert an empty list is returned.\n\n   e. test_scan_ideas_skips_dotfiles():\n\
      \      - Create a .hidden.md file and a normal.md file.\n      - Monkeypatch\
      \ IDEAS_DIR.\n      - Call scan_ideas().\n      - Assert only normal.md is returned.\n\
      \n3. Run the tests:\n   ~/.pyenv/versions/3.11.*/bin/python -m pytest tests/test_auto_pipeline.py\
      \ -v -k scan_ideas\n   Fix any failures before marking this task complete.\n\
      \nFiles: tests/test_auto_pipeline.py\n"
  - id: '2.2'
    name: Add unit tests for process_idea() and intake_ideas()
    agent: coder
    status: pending
    depends_on:
    - '1.3'
    description: "Add unit tests for process_idea() and intake_ideas() functions.\n\
      \nReference: docs/plans/2026-02-18-ideas-intake-pipeline-design.md\n\nSteps:\n\
      1. Read tests/test_auto_pipeline.py to understand existing test patterns,\n\
      \   especially how run_child_process is mocked.\n\n2. Add the following tests:\n\
      \n   a. test_process_idea_dry_run():\n      - Create a temporary idea .md file.\n\
      \      - Call process_idea(idea_path, dry_run=True).\n      - Assert it returns\
      \ True without spawning any subprocess.\n      - Assert the idea file was NOT\
      \ moved.\n\n   b. test_process_idea_success():\n      - Create a temporary idea\
      \ .md file.\n      - Monkeypatch run_child_process to return a successful\n\
      \        ProcessResult.\n      - Create the processed/ directory and simulate\
      \ the file\n        being moved there (as the Claude session would do).\n   \
      \   - Call process_idea().\n      - Assert it returns True.\n\n   c. test_process_idea_rate_limited():\n\
      \      - Monkeypatch run_child_process to return a ProcessResult with\n     \
      \   rate_limited=True.\n      - Call process_idea().\n      - Assert it returns\
      \ False.\n\n   d. test_intake_ideas_processes_all():\n      - Monkeypatch scan_ideas()\
      \ to return a list of 2 file paths.\n      - Monkeypatch process_idea() to always\
      \ return True.\n      - Call intake_ideas(dry_run=False).\n      - Assert it\
      \ returns 2.\n      - Assert process_idea() was called twice.\n\n   e. test_intake_ideas_returns_zero_when_no_ideas():\n\
      \      - Monkeypatch scan_ideas() to return an empty list.\n      - Call intake_ideas(dry_run=False).\n\
      \      - Assert it returns 0.\n\n3. Run the tests:\n   ~/.pyenv/versions/3.11.*/bin/python\
      \ -m pytest tests/test_auto_pipeline.py -v\n   Fix any failures before marking\
      \ this task complete.\n\nFiles: tests/test_auto_pipeline.py\n"
- id: phase-3
  name: Phase 3 - Plugin Version Bump
  status: pending
  tasks:
  - id: '3.1'
    name: Bump plugin version and update release notes
    agent: coder
    status: pending
    depends_on:
    - '1.3'
    description: "Bump the plugin version in plugin.json and update RELEASE-NOTES.md\n\
      for the ideas-intake-pipeline feature.\n\nSteps:\n1. Read plugin.json. Find\
      \ the current version number.\n2. Bump the minor version (this is a new feature).\n\
      3. Read RELEASE-NOTES.md. Add a new entry at the top for the new\n   version\
      \ with a summary:\n   - Added ideas intake pipeline: drop rough notes in\n \
      \    docs/ideas/ and they are automatically classified and converted\n     into\
      \ properly formatted backlog items.\n4. Git commit both files:\n   git add plugin.json\
      \ RELEASE-NOTES.md\n   git commit -m \"chore: bump version for ideas-intake-pipeline\
      \ feature\"\n\nFiles: plugin.json, RELEASE-NOTES.md\n"
- id: phase-4
  name: Phase 4 - Verification
  status: pending
  tasks:
  - id: '4.1'
    name: Final verification - syntax, tests, and dry-run
    agent: code-reviewer
    status: pending
    depends_on:
    - '2.1'
    - '2.2'
    - '3.1'
    description: "Run all verification checks to confirm the feature is correctly\n\
      implemented and all tests pass.\n\nSteps:\n1. Check Python syntax for both scripts:\n\
      \   python3 -c \"import py_compile; py_compile.compile('scripts/auto-pipeline.py',\
      \ doraise=True); py_compile.compile('scripts/plan-orchestrator.py', doraise=True)\"\
      \n\n2. Run the full test suite:\n   ~/.pyenv/versions/3.11.*/bin/python -m pytest\
      \ tests/ -v\n\n3. Verify the new constants and functions exist in auto-pipeline:\n\
      \   python3 -c \"\n   import importlib.util\n   spec = importlib.util.spec_from_file_location('ap',\
      \ 'scripts/auto-pipeline.py')\n   mod = importlib.util.module_from_spec(spec)\n\
      \   spec.loader.exec_module(mod)\n   assert hasattr(mod, 'IDEAS_DIR'), 'IDEAS_DIR\
      \ not found'\n   assert hasattr(mod, 'IDEAS_PROCESSED_DIR'), 'IDEAS_PROCESSED_DIR\
      \ not found'\n   assert callable(mod.scan_ideas), 'scan_ideas not callable'\n\
      \   assert callable(mod.process_idea), 'process_idea not callable'\n   assert\
      \ callable(mod.intake_ideas), 'intake_ideas not callable'\n   assert mod.IDEAS_DIR\
      \ in [d for d in mod.REQUIRED_DIRS], 'IDEAS_DIR not in REQUIRED_DIRS'\n   assert\
      \ mod.IDEAS_PROCESSED_DIR in [d for d in mod.REQUIRED_DIRS], 'IDEAS_PROCESSED_DIR\
      \ not in REQUIRED_DIRS'\n   print('All new constants and functions verified OK')\n\
      \   \"\n\n4. Verify the prompt template exists and has required placeholders:\n\
      \   python3 -c \"\n   import importlib.util\n   spec = importlib.util.spec_from_file_location('ap',\
      \ 'scripts/auto-pipeline.py')\n   mod = importlib.util.module_from_spec(spec)\n\
      \   spec.loader.exec_module(mod)\n   tmpl = mod.IDEA_INTAKE_PROMPT_TEMPLATE\n\
      \   assert '{idea_path}' in tmpl, 'Missing idea_path placeholder'\n   assert\
      \ '{feature_dir}' in tmpl, 'Missing feature_dir placeholder'\n   assert '{defect_dir}'\
      \ in tmpl, 'Missing defect_dir placeholder'\n   assert '{processed_dir}' in\
      \ tmpl, 'Missing processed_dir placeholder'\n   print('Prompt template verified\
      \ OK')\n   \"\n\n5. Run orchestrator dry-run to confirm no startup errors:\n\
      \   python3 scripts/plan-orchestrator.py --plan .claude/plans/sample-plan.yaml\
      \ --dry-run\n\n6. Run the full test suite one more time to confirm stability:\n\
      \   python3 -m pytest tests/ 2>/dev/null || echo 'No test suite configured'\n\
      \nIf any check fails, report the specific failure with details.\n\nFiles: scripts/auto-pipeline.py,\
      \ scripts/plan-orchestrator.py,\n  tests/test_auto_pipeline.py, plugin.json,\
      \ RELEASE-NOTES.md\n"
