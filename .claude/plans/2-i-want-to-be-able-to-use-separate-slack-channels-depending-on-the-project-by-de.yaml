meta:
  name: Per-Project Slack Channel Prefix (Duplicate Verification)
  description: 'Verify that the per-project Slack channel prefix feature (backlog
    item #2) is already implemented by item #1. Run verification checks, confirm tests
    pass, and archive the duplicate backlog item.

    '
  plan_doc: docs/plans/2026-02-17-2-i-want-to-be-able-to-use-separate-slack-channels-depending-on-the-project-by-de-design.md
  created: '2026-02-17'
  max_attempts_default: 3
  validation:
    enabled: true
    run_after:
    - coder
    validators:
    - validator
    max_validation_attempts: 1
sections:
- id: phase-1
  name: Phase 1 - Verification
  status: completed
  tasks:
  - id: '1.1'
    name: Verify per-project channel prefix implementation
    agent: code-reviewer
    status: completed
    description: "Verify the per-project Slack channel prefix feature is fully implemented.\
      \ This backlog item (#2) is a duplicate of item #1, which was completed on 2026-02-16.\n\
      Steps:\n1. Check Python syntax for both scripts:\n   python3 -c \"import py_compile;\
      \ py_compile.compile('scripts/auto-pipeline.py', doraise=True); py_compile.compile('scripts/plan-orchestrator.py',\
      \ doraise=True)\"\n\n2. Run all unit tests:\n   python3 -m pytest tests/ 2>/dev/null\
      \ || echo 'No test suite configured'\n\n3. Verify SLACK_CHANNEL_ROLE_SUFFIXES\
      \ exists and SLACK_CHANNEL_ROLES is removed:\n   python3 -c \"\n   import importlib.util\n\
      \   spec = importlib.util.spec_from_file_location('po', 'scripts/plan-orchestrator.py')\n\
      \   mod = importlib.util.module_from_spec(spec)\n   spec.loader.exec_module(mod)\n\
      \   assert hasattr(mod, 'SLACK_CHANNEL_ROLE_SUFFIXES'), 'Missing SLACK_CHANNEL_ROLE_SUFFIXES'\n\
      \   assert not hasattr(mod, 'SLACK_CHANNEL_ROLES'), 'Old SLACK_CHANNEL_ROLES\
      \ should be removed'\n   suffixes = mod.SLACK_CHANNEL_ROLE_SUFFIXES\n   assert\
      \ suffixes['features'] == 'feature'\n   assert suffixes['defects'] == 'defect'\n\
      \   assert suffixes['questions'] == 'question'\n   assert suffixes['notifications']\
      \ == 'control'\n   print('SLACK_CHANNEL_ROLE_SUFFIXES verified')\n   \"\n\n\
      4. Verify SlackNotifier reads channel_prefix from config:\n   python3 -c \"\n\
      \   import importlib.util, tempfile, os, yaml\n   spec = importlib.util.spec_from_file_location('po',\
      \ 'scripts/plan-orchestrator.py')\n   mod = importlib.util.module_from_spec(spec)\n\
      \   spec.loader.exec_module(mod)\n   notifier = mod.SlackNotifier('/nonexistent')\n\
      \   assert notifier._channel_prefix == 'orchestrator-', 'Bad default prefix'\n\
      \   with tempfile.NamedTemporaryFile(mode='w', suffix='.yaml', delete=False)\
      \ as f:\n       yaml.dump({'slack': {'enabled': True, 'bot_token': 'xoxb-test',\
      \ 'channel_id': 'C1', 'channel_prefix': 'myproj-'}}, f)\n       tmp = f.name\n\
      \   try:\n       n2 = mod.SlackNotifier(config_path=tmp)\n       assert n2._channel_prefix\
      \ == 'myproj-', f'Bad custom prefix: {n2._channel_prefix}'\n   finally:\n  \
      \     os.unlink(tmp)\n   print('channel_prefix config loading verified')\n \
      \  \"\n\n5. Verify _get_channel_role works with custom prefix:\n   python3 -c\
      \ \"\n   import importlib.util\n   spec = importlib.util.spec_from_file_location('po',\
      \ 'scripts/plan-orchestrator.py')\n   mod = importlib.util.module_from_spec(spec)\n\
      \   spec.loader.exec_module(mod)\n   notifier = mod.SlackNotifier('/nonexistent')\n\
      \   assert notifier._get_channel_role('orchestrator-features') == 'feature'\n\
      \   assert notifier._get_channel_role('orchestrator-defects') == 'defect'\n\
      \   assert notifier._get_channel_role('other-features') == ''\n   print('_get_channel_role\
      \ verified')\n   \"\n\n6. Verify config template has channel_prefix field:\n\
      \   python3 -c \"\n   import yaml\n   with open('.claude/slack.local.yaml.template')\
      \ as f:\n       config = yaml.safe_load(f)\n   assert 'channel_prefix' in config['slack'],\
      \ 'Missing channel_prefix in template'\n   assert config['slack']['channel_prefix']\
      \ == 'orchestrator-'\n   print('Config template has channel_prefix field')\n\
      \   \"\n\n7. Run orchestrator dry-run to verify no startup errors:\n   python3\
      \ scripts/plan-orchestrator.py --plan .claude/plans/sample-plan.yaml --dry-run\n\
      \nIf any check fails, report the failure with specific details.\nFiles: scripts/plan-orchestrator.py,\
      \ scripts/auto-pipeline.py,\n       .claude/slack.local.yaml.template, tests/test_slack_notifier.py\n"
    attempts: 1
    last_attempt: '2026-02-17T00:07:00.827684'
    model_used: sonnet
    completed_at: '2026-02-17T00:09:01.367635'
    result_message: 'PASS: All 7 verification checks passed. Feature fully implemented
      and working (152 tests passed, orchestrator dry-run successful, channel discovery
      working with orchestrator- prefix)'
- id: phase-2
  name: Phase 2 - Archive Duplicate
  status: pending
  tasks:
  - id: '2.1'
    name: Archive duplicate backlog item
    agent: coder
    status: pending
    depends_on:
    - '1.1'
    description: "Move the duplicate backlog item to completed-backlog.\nSteps:\n\
      1. Read docs/feature-backlog/2-i-want-to-be-able-to-use-separate-slack-channels-depending-on-the-project-by-de.md\n\
      2. Update the status from \"Open\" to \"Closed (Duplicate)\" and add a note\n\
      \   explaining this is a duplicate of item #1.\n\n3. Move the file to docs/completed-backlog/features/\
      \ using git mv:\n   git mv \"docs/feature-backlog/2-i-want-to-be-able-to-use-separate-slack-channels-depending-on-the-project-by-de.md\"\
      \ \"docs/completed-backlog/features/2-i-want-to-be-able-to-use-separate-slack-channels-depending-on-the-project-by-de.md\"\
      \n\n4. Verify the file was moved:\n   python3 -c \"\n   import os\n   src =\
      \ 'docs/feature-backlog/2-i-want-to-be-able-to-use-separate-slack-channels-depending-on-the-project-by-de.md'\n\
      \   dst = 'docs/completed-backlog/features/2-i-want-to-be-able-to-use-separate-slack-channels-depending-on-the-project-by-de.md'\n\
      \   assert not os.path.exists(src), f'Source still exists: {src}'\n   assert\
      \ os.path.exists(dst), f'Destination missing: {dst}'\n   with open(dst) as f:\n\
      \       content = f.read()\n   assert 'Duplicate' in content, 'Missing duplicate\
      \ note in file'\n   print('Backlog item archived as duplicate')\n   \"\n\nFiles:\
      \ docs/feature-backlog/2-i-want-to-be-able-to-use-separate-slack-channels-depending-on-the-project-by-de.md\n"
